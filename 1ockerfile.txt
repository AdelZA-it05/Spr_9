# Используем готовый образ selenium с Chrome и chromedriver
# FROM selenium/standalone-chrome:latest
FROM selenium/standalone-chrome:122.0

# Устанавливаем Python и pip внутри контейнера
USER root
RUN apt-get update && apt-get install -y python3 python3-pip \
    && rm -rf /var/lib/apt/lists/*

# Копируем проект
WORKDIR /app
COPY requirements.txt .
RUN pip3 install --no-cache-dir -r requirements.txt
COPY . .

# Проверяем версию ChromeDriver
RUN chromedriver --version

# Проверяем версию Google Chrome
RUN google-chrome --version

# Открытие порта 4444
# EXPOSE 4444

# ENTRYPOINT ["/usr/bin/selenoid", "-listen", ":4444", "-conf", "/etc/selenoid/browsers.json", "-video-output-dir", "/opt/selenoid/video/"]

# Переменные окружения (Chromium уже в другом контейнере)
# ENV SELENIUM_REMOTE_URL="http://selenium:4444/wd/hub"

# Проверяем аботает ли локальный сервер Selenium
# RUN curl -f http://127.0.0.1:4444/wd/hub/ || exit 1

# Запускаем pytest по умолчанию
CMD ["pytest"]
# CMD ["pytest", "--alluredir", "allure_results"]
#CMD ["pytest"]
